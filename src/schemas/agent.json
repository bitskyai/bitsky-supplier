{
  "$schema": "http://json-schema.org/draft-07/schema",
  "$id": "https://munew.io/schemas/agent.json",
  "type": "object",
  "title": "Agent Schema",
  "version": "1.1.0",
  "additionalProperties": false,
  "required": [
    "globalId",
    "type",
    "name",
    "state",
    "private",
    "concurrent",
    "pollingInterval",
    "maxWaitingTime",
    "maxCollect",
    "idelTime",
    "timeout",
    "maxRetry"
  ],
  "properties": {
    "system": {
      "description": "Following properties are updated by system, user cannot direct update them",
      "additionalProperties": false,
      "required": ["state", "version"],
      "properties": {
        "state": {
          "$ref": "#/definitions/state"
        },
        "version": {
          "$ref": "#/definitions/version"
        },
        "created": {
          "title": "Created at",
          "type": "integer",
          "description": "Timestamp of when this intelligence was created",
          "examples": [1553974629109]
        },
        "modified": {
          "title": "Last time modified at",
          "type": "integer",
          "description": "Timestamp of when this intelligence was last time modified",
          "examples": [1553974629109]
        }
      }
    },
    "id": {
      "title": "ID",
      "description": "identifier of this agent",
      "type": "string"
    },
    "globalId": {
      "$ref": "#/definitions/globalId"
    },
    "type": {
      "$ref": "#/definitions/agentType"
    },
    "name": {
      "$ref": "#/definitions/name"
    },
    "description": {
      "$ref": "#/definitions/description"
    },
    "private": {
      "title": "Private Mode",
      "type": "boolean",
      "description": "Whether collect intelligences that not created by yourself",
      "default": true
    },
    "concurrent": {
      "title": "Concurrent Collect Intelligences",
      "type": "number",
      "description": "How many intelligences need to be concurrent collected",
      "default": 1
    },
    "pollingInterval": {
      "title": "Polling Interval",
      "type": "number",
      "description": "Unit: second. How frequently to check whether need to collect new intelligences",
      "default": 30
    },
    "maxWaitingTime": {
      "title": "Max Waiting Time",
      "type": "number",
      "description": "Unit: second. Max waiting time between two collecting jobs.",
      "default": 5
    },
    "maxCollect": {
      "title": "Max Collect Intelligences",
      "type": "number",
      "description": "**undefined** means infinity. Browser has memory leak issue if continue to open urls. To avoid this, need to close window when reach max collect times. Collect Time equal to how many request send to DIA to get intelligence."
    },
    "idelTime": {
      "title": "Agent Idel Time",
      "type": "number",
      "description": "How long time browser need to wait to restart collect intelligences after close browser window. This time is used for browser to release memory.",
      "default": 0
    },
    "timeout": {
      "title": "Request Timeout",
      "type": "number",
      "description": "Unit: second. If the request takes longer than timeout, the request will be aborted",
      "default": 90
    },
    "maxRetry": {
      "title": "Max Retry Time",
      "type": "number",
      "description": "Max retry time if send collected intelligences fail, if retried max time, then it will send back to DIA and mark those intelligences fail",
      "default": 3
    }
  },
  "definitions": {
    "created": {
      "allOf": [
        {
          "$ref": "#/definitions/timestamp"
        },
        {
          "title": "Created at"
        }
      ]
    },
    "modified": {
      "allOf": [
        {
          "$ref": "#/definitions/timestamp"
        },
        {
          "title": "Last time modified at"
        }
      ]
    },
    "timestamp": {
      "type": "integer",
      "description": "Timestamp of when this intelligence was assigned to an agent",
      "examples": [1553974629109]
    },
    "version": {
      "title": "Version",
      "description": "version of this agent",
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "default": "1.0.0",
      "examples": ["1.0.0"]
    },
    "globalId": {
      "title": "Global ID",
      "description": "globally unique identifier",
      "type": "string",
      "examples": ["59f43b55-46a3-4efc-a960-018bcca91f46"]
    },
    "agentType": {
      "title": "Agent Type",
      "type": "string",
      "description": "Agent type of this agent",
      "enum": ["BROWSEREXTENSION", "SERVICE", "HEADLESSBROWSER"]
    },
    "permission": {
      "type": "string",
      "description": "Decide whether this agent to accept public intelligences. if it is **private**, then don't accept public intelligences",
      "default": "private",
      "enum": ["private", "public"]
    },
    "url": {
      "type": "string",
      "format": "uri",
      "description": "Target URL for this intelligence.",
      "examples": ["https://json-schema.org"]
    },
    "name": {
      "title": "Name",
      "description": "Give a meaningful name",
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "examples": ["My Chrome Extension"]
    },
    "description": {
      "title": "Description",
      "description": "description of this agent",
      "type": "string",
      "minLength": 1,
      "maxLength": 200,
      "examples": ["My chrome extension used for test purpose"]
    },
    "securityKey": {
      "title": "Security Key",
      "type": "string",
      "description": "Security key is used to identify different user"
    },
    "state": {
      "title": "State",
      "type": "string",
      "description": "State of this entitle",
      "enum": ["DRAFT", "CONFIGURED", "ACTIVE", "DELETED"]
    }
  }
}
